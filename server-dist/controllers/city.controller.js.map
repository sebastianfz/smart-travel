{"version":3,"sources":["../../server/controllers/city.controller.js"],"names":["cityController","getAllCities","req","res","find","err","cities","send","json","getTopCities","limit","exec","getCity","findOne","_id","params","id","city","addCity","console","log","body","save","text","done","saveCity","data","update","$set","updateCity","deleteCity","isActive","getCityDetails","key","googlekey","encodeURIComponent","http","require","url","googlePlaceSearch","get","response","on","chunk","places","JSON","parse","e","message","getPlaceDetails","placeId","placeid","googlePlaceDetails"],"mappings":"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","file":"city.controller.js","sourcesContent":["// src/controllers/main.js\r\nimport City from '../models/city'; // Import the Todo model so we can query the DB\r\nimport config from '../config/config';\r\n\r\n\r\nlet cityController = {\r\n\r\n    getAllCities: (req, res) => {\r\n        City.find({}, (err, cities) => {\r\n            if (err) {\r\n                // Send the error to the client if there is one\r\n                return res.send(err);\r\n            }\r\n            // Send todos in JSON format\r\n            res.json(cities);\r\n        });\r\n    },\r\n\r\n    getTopCities: (req, res) => {\r\n        City.find({}).limit(8).exec((err, cities) => {\r\n            if (err) {\r\n                // Send the error to the client if there is one\r\n                return res.send(err);\r\n            }\r\n            // Send todos in JSON format\r\n            res.json(cities);\r\n        })\r\n    },\r\n\r\n    getCity: (req, res) => {\r\n        City.findOne({ _id: req.params.id }, (err, city) => {\r\n            if (err) {\r\n                // Send the error to the client if there is one\r\n                return res.send(err);\r\n            }\r\n            // Send todos in JSON format\r\n            res.json(city);\r\n        });\r\n    },\r\n\r\n    addCity: (req, res) => {\r\n        console.log(req.city);\r\n        let city = new City(req.body);\r\n        city.save({\r\n            text: req.body.text,\r\n            done: false\r\n        }, (err, city) => {\r\n            if (err) {\r\n                return res.send(err);\r\n            }\r\n            res.json(city);\r\n        });\r\n    },\r\n\r\n    saveCity: (data, id) => {\r\n        City.update({\r\n            _id: id\r\n        }, { $set: data }, (err, city) => {\r\n            if (err) {\r\n                return res.send(err);\r\n            }\r\n            res.json(city);\r\n        });\r\n    },\r\n\r\n    updateCity: (req, res) => {\r\n        let id = req.params.id;\r\n        let data = req.body;\r\n        saveCity(data, id);\r\n    },\r\n\r\n    deleteCity: (req, res) => {\r\n        City.findOne({ _id: req.params.id }, (err, city) => {\r\n            if (err) {\r\n                return res.send(err);\r\n            }\r\n            city.isActive = false;\r\n            saveCity(data, req.params.id);\r\n        });\r\n    },\r\n\r\n    getCityDetails: (req, res) => {\r\n        let key = config.googlekey;\r\n        let city = encodeURIComponent(req.params.city);\r\n        var http = require(\"https\");\r\n        let url = config.googlePlaceSearch + \"key=\" + key + \"&query=\" + city;\r\n        http.get(url, function (response) {\r\n            let body = '';\r\n            response.on('data', (chunk) => {\r\n                body += chunk;\r\n            });\r\n            response.on('end', () => {\r\n                let places = JSON.parse(body);\r\n                res.json(places);\r\n            });\r\n        }).on('error', function (e) {\r\n            console.log(\"Got error: \" + e.message);\r\n            res.send(err);\r\n        });\r\n    },\r\n\r\n    getPlaceDetails: (req, res) => {\r\n        let key = config.googlekey;\r\n        let placeId = encodeURIComponent(req.params.placeid);\r\n        var http = require(\"https\");\r\n        let url = config.googlePlaceDetails + \"key=\" + key + \"&placeid=\" + placeId;\r\n        http.get(url, function (response) {\r\n            let body = '';\r\n            response.on('data', (chunk) => {\r\n                body += chunk;\r\n            });\r\n            response.on('end', () => {\r\n                let places = JSON.parse(body);\r\n                res.json(places);\r\n            });\r\n        }).on('error', function (e) {\r\n            console.log(\"Got error: \" + e.message);\r\n            res.send(err);\r\n        });\r\n    }\r\n}\r\n\r\nexport default cityController;"]}